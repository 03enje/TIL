# 트리거
> 데이터베이스에서 이벤트가 발생한 경우 자동으로 실행되는 기능

## 트리거 생성
```SQL
/*
 * 트리거란?
 * 데이터베이스 안의 특정 상황이나 동작, 즉 이벤트가 발생할 경우
 * 자동으로 실행되는 기능을 정의하는 PL/SQL 서브프로그램
  
 * 기능 : 데이터를 변경하지 못하게 막는 기능
 *        데이터 베이스 가동, 종료 시에 관련업무자에게 정보를 전달해주는 기능
 */
 
-- EMP_TRG_LOG 직원정보 이력 테이블
CREATE TABLE EMP_TRG_LOG(
  TABLENAME   VARCHAR2(10), -- DML이 수행된 테이블 이름
  DML_TYPE    VARCHAR2(10), -- DML 명령어의 종류
  ENO NUMBER(4), -- DML 대상이 된 사원번호
  USER_NAME   VARCHAR2(30), -- DML을 수행한 USER 이름
  CHANGE_DATE DATE -- DML이 수행된 날짜
);

CREATE TABLE EMP_TRG
    AS SELECT * FROM EMPLOYEE;
SELECT * FROM EMP_TRG;

-- 트리거 생성하기
CREATE OR REPLACE TRIGGER trg_emp_log
AFTER
INSERT OR UPDATE OR DELETE ON EMP_TRG
FOR EACH ROW

BEGIN
  IF INSERTING THEN
    INSERT INTO emp_trg_log
    VALUES('EMP_TRG', 'INSERT', :new.eno,
      SYS_CONTEXT('USERENV', 'SESSION_USER'), sysdate);
  ELSIF UPDATING THEN
    INSERT INTO emp_trg_log
    VALUES('EMP_TRG', 'UPDATE', :old.eno,
      SYS_CONTEXT('USERENV', 'SESSION_USER'), sysdate);
  ELSIF DELETING THEN
    INSERT INTO emp_trg_log
    VALUES('EMP_TRG', 'DELETE', :old.eno,
      SYS_CONTEXT('USERENV', 'SESSION_USER'), sysdate);
  END IF;
END;
/
```
## 트리거 실행
```SQL
-- INSERT문 실행
INSERT INTO EMP_TRG
VALUES(9999, 'TestEmp', 'clerk', 7788, 
         TO_DATE('2022-12-13', 'YYYY-MM-DD'), 1200, NULL, 20);
         
SELECT * FROM emp_trg_log;

-- OUTPUT --
TABLENAME  DML_TYPE          ENO USER_NAME                      CHANGE_DAT
---------- ---------- ---------- ------------------------------ ----------
EMP_TRG    INSERT           9999 HR                             2022-12-13

-- UPDATE문 실행
UPDATE EMP_TRG
   SET SALARY = 1300
 WHERE MANAGER = 7788;
 
SELECT * FROM emp_trg_log;

-- OUTPUT --
TABLENAME  DML_TYPE          ENO USER_NAME                      CHANGE_DAT
---------- ---------- ---------- ------------------------------ ----------
EMP_TRG    INSERT           9999 HR                             2022-12-13
EMP_TRG    UPDATE           7876 HR                             2022-12-13
EMP_TRG    UPDATE           9999 HR                             2022-12-13
```